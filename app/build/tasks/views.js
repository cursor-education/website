// the "views" task
// will collect & compile all templates

module.exports = (gulp, params, done) => {
  // const env = require('gulp-environment');
  // const fs = require('fs');
  // const path = require('path');
  // const glob = require('glob');
  // const _ = require('underscore');
  const browserSync = require('browser-sync');

  let reload = browserSync.reload;

  return gulp
    .src(`${params.paths.src}/views/**/*`)
    .pipe(gulp.dest(`${params.paths.dest}/views`))
    .pipe(reload({stream: true}));

  // return gulp.src(`${params.paths.src}/views/pages/*.pug`)
  //   .pipe(params.plugins.pug({
  //     locals: (() => {
  //       let locals = {
  //         'revision': getRevisionsMapping(),
  //         'config': params.config,
  //         'data': {}
  //       };

  //       // parse {tmp,src}/data/*.json files,
  //       // and pass data to templates
  //       glob.sync(`{${params.paths.tmp}/data-,${params.paths.src}/data/}*.json`)
  //           .forEach((filename) => {
  //             let values = JSON.parse(fs.readFileSync(filename, 'utf8'));
  //             let key = path.basename(filename, '.json').replace(/^data\-/, '');

  //             locals.data[key] = values;
  //           });

  //       // all data will be injected to templates from views/*.pug directory
  //       return locals;
  //     })(),
  //     pretty: env.is.development() ? '  ' : false
  //   }))

  //   .pipe(gulp.dest(params.paths.dest))
  //   .pipe(reload({stream: true}));

  // // returns map generated by `rev` plugin
  // function getRevisionsMapping() {
  //   let revisionFile = `${params.paths.dest}/revision.json`;

  //   if (!fs.existsSync(revisionFile)) {
  //     let files = glob.sync(`${params.paths.dest}/*.{js,css}`)
  //       .map((filename) => {
  //         let key = path.basename(filename);
  //         return key;
  //       })
  //       .reduce((total,current) => {
  //         total[current] = current;
  //         return total;
  //       }, {});

  //     return files;
  //   }

  //   return JSON.parse(fs.readFileSync(revisionFile, 'utf8'));
  // }
};
